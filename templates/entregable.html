{% extends "base.html" %}

{% block titulo_pagina %}Gestión de Entregables{% endblock %}


{% block contenido %}
    <h1 style="text-align:center; margin-top: 10px;">Gestión de Entregables</h1>

    <!-- FORMULARIO CREAR / ACTUALIZAR -->
    <form method="post"
          action="{{ url_for('rutas_entregable.crear_entregable') if modo == 'crear' else url_for('rutas_entregable.actualizar_entregable') }}"
          style="max-width: 980px; margin: 0 auto 10px; display:flex; gap:8px; flex-wrap:wrap;">
        
        {% if modo == 'actualizar' %}
            <input type="hidden" name="id" value="{{ entregable.id }}">
        {% endif %}

        <input type="text" name="codigo" placeholder="Código" value="{{ entregable.codigo if entregable else '' }}" required style="flex: 0 0 120px;">
        <input type="text" name="titulo" placeholder="Título" value="{{ entregable.titulo if entregable else '' }}" required style="flex: 1;">
        <input type="text" name="descripcion" placeholder="Descripción" value="{{ entregable.descripcion if entregable else '' }}" style="flex: 1 0 250px;">
        <input type="date" name="fecha_inicio" value="{{ entregable.fecha_inicio if entregable else '' }}" style="flex: 0 0 140px;">
        <input type="date" name="fecha_fin_prevista" value="{{ entregable.fecha_fin_prevista if entregable else '' }}" style="flex: 0 0 140px;">
        <input type="date" name="fecha_modificacion" value="{{ entregable.fecha_modificacion if entregable else '' }}" style="flex: 0 0 140px;">
        <input type="date" name="fecha_finalizacion" value="{{ entregable.fecha_finalizacion if entregable else '' }}" style="flex: 0 0 140px;">

        <button type="submit" style="padding: 6px 12px;">
            {{ "Agregar" if modo == "crear" else "Actualizar" }}
        </button>
    </form>

    <!-- FORMULARIO BUSCAR -->
    <form method="post" action="{{ url_for('rutas_entregable.buscar_entregable') }}" style="max-width:400px;margin: 0 auto 12px; display:flex; gap:8px;">
        <input type="number" name="id_buscar" placeholder="Buscar por ID" required style="flex:1;">
        <button type="submit">Buscar</button>
    </form>

    {% if mensaje %}
        <p style="color: red; text-align:center;">{{ mensaje }}</p>
    {% endif %}

    <!-- TABLA CENTRADA -->
    <div style="max-width: 1100px; margin: 20px auto;">
        <table border="1" cellpadding="6" cellspacing="0" style="width:100%; border-collapse:collapse;">
            <thead style="background:#f2f2f2;">
                <tr>
                    <th>ID</th>
                    <th>Código</th>
                    <th>Título</th>
                    <th>Descripción</th>
                    <th>Inicio</th>
                    <th>Fin Prevista</th>
                    <th>Modificación</th>
                    <th>Finalización</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for e in entregables %}
                    <tr>
                        <td>{{ e.id }}</td>
                        <td>{{ e.codigo }}</td>
                        <td>{{ e.titulo }}</td>
                        <td>{{ e.descripcion }}</td>
                        <td>{{ e.fecha_inicio or '' }}</td>
                        <td>{{ e.fecha_fin_prevista or '' }}</td>
                        <td>{{ e.fecha_modificacion or '' }}</td>
                        <td>{{ e.fecha_finalizacion or '' }}</td>
                        <td style="text-align:center;">
                            <form method="post" action="{{ url_for('rutas_entregable.buscar_entregable') }}" style="display:inline;">
                                <input type="hidden" name="id_buscar" value="{{ e.id }}">
                                <button type="submit">Editar</button>
                            </form>

                            <form method="post" action="{{ url_for('rutas_entregable.eliminar_entregable', id=e.id) }}" style="display:inline;">
                                <button type="submit" onclick="return confirm('¿Eliminar entregable {{ e.id }}?')">Eliminar</button>
                            </form>
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="9" style="text-align:center; color:#666;">No hay entregables registrados.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}
